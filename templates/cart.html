{% extends 'base.html' %}
{% block title %}Shopping Cart{% endblock %}
{% block content %}
  <div class="container bg-white rounded shadow p-4 mt-4">
    <h2 class="mb-4 font-bold text-2xl">Shopping Cart</h2>
    {% if cart_items and cart_items|length > 0 %}
    <form id="cartForm">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Product</th>
            <th>Variant</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          {% for item in cart_items %}
          <tr>
            <td>
              <img src="/static/images/{{ item[7] }}" alt="{{ item[1] }}" style="width:60px; height:60px; object-fit:cover;" class="rounded mr-2" />
              <span class="font-bold">{{ item[1] }}</span>
            </td>
            <td>
              {% if item[-4] %}
              {{ item[-4] }}: {{ item[-3] }}
              {% if item[-2] and item[-2] != 0 %}
              <span class="text-muted">(+${{ item[-2]|round(2) }})</span>
              {% endif %}
              {% else %}
              -
              {% endif %}
            </td>
            <td>
              ${{ (item[3] + (item[-2] or 0))|round(2) }}
            </td>
            <td>
              <input type="number" name="quantity_{{ item[0] }}_{{ item[-3] or 'none' }}" value="{{ item[-1] }}" min="1" class="form-control w-24" />
            </td>
            <td>
              ${{ ((item[3] + (item[-2] or 0)) * (item[-1] or 1))|round(2) }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="row mt-4">
        <div class="col-md-6">
          <div class="form-group">
            <label for="coupon">Coupon Code:</label>
            <input type="text" class="form-control w-48 d-inline-block" id="coupon" name="coupon" placeholder="Enter coupon code" />
            <button type="button" class="btn btn-outline-primary ml-2" onclick="applyCoupon()">Apply</button>
          </div>
        </div>
        <div class="col-md-6 text-right">
          <h4>Total: <span class="text-success">${{ total|round(2) }}</span></h4>
          <a href="{{ url_for('user.delivery') }}" class="btn btn-primary mt-2">Proceed to Checkout</a>
        </div>
      </div>
    </form>
    {% else %}
    <p>Your cart is empty.</p>
    {% endif %}
  </div>
{% endblock %}
{% block scripts %}
<script>
  function applyCoupon() {
    alert("Coupon feature coming soon!");
  }
</script>
{% endblock %}
